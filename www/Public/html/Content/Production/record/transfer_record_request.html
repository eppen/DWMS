<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width:70%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">转移联单申请</h4>
            </div>
            <div class="modal-body" id="model-content">
            </div>
            <div class="modal-footer"></div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<form role="form" id="record_request">
    <div class="panel panel-primary">
        <div class="panel-heading">基本信息</div>
        <div class="panel-body">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover table-condensed">
                    <tr>
                        <td>单位名称</td>
                        <td>
                            {$unit.production_unit_name}
                        </td>
                        <td>单位用户名称</td>
                        <td>
                            {$unit.production_unit_username}
                        </td>
                    </tr>
                    <tr>
                        <td>备案类型</td>
                        <td>
                            <input type="text" name="record_type" class="form-control input-sm" placeholder="备案类型">
                        </td>
                        <td>备案日期</td>
                        <td>
                            <input type="date" name="record_date" class="form-control input-sm" placeholder="备案日期">
                        </td>
                    </tr>
                    <tr>
                        <td>法人代码</td>
                        <td>
                            {$unit.production_unit_legal_person_code}
                        </td>
                        <td>单位地址</td>
                        <td>
                            {$unit.production_unit_address}
                        </td>
                    </tr>
                    <tr>
                        <td>邮政编码</td>
                        <td>
                            {$unit.production_unit_postcode}
                        </td>
                        <td>所在区县</td>
                        <td>
                            {$unit.waste_location_county}
                        </td>
                    </tr>
                    <tr>
                        <td>联系人姓名</td>
                        <td>
                            {$unit.production_unit_contacts_name}
                        </td>
                        <td>联系电话</td>
                        <td>
                            {$unit.production_unit_contacts_phone}
                        </td>
                    </tr>
                    <tr>
                        <td>单位传真</td>
                        <td>
                            {$unit.production_unit_fax}
                        </td>
                        <td>产废设施所在地</td>
                        <td>
                            {$unit.waste_location}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-primary">
        <div class="panel-heading">工艺方法</div>
        <div class="panel-body">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover table-condensed">
                    <tr>
                        <td>工艺序号</td>
                        <td>
                            <input type="text" name="technology_code" class="form-control input-sm" placeholder="工艺序号">
                        </td>
                        <td>工艺方法</td>
                        <td>
                            <input type="text" name="technology_method" class="form-control input-sm" placeholder="工艺方法">
                        </td>
                    </tr>
                    <tr>
                        <td>危废代码</td>
                        <td>
                            <input type="text" name="waste_code" class="form-control input-sm" placeholder="危废代码">
                        </td>
                        <td>相关产品</td>
                        <td>
                            <input type="text" name="relational_production" class="form-control input-sm" placeholder="相关产品">
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-primary">
        <div class="panel-heading">危险废物产生情况</div>
        <div class="panel-body">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover table-condensed">
                    <tr>
                        <td>废物名称</td>
                        <td>
                            <input type="text" name="waste_name" class="form-control input-sm" placeholder="废物代码">
                        </td>
                        <td>废物形态</td>
                        <td>
                            <input type="text" name="waste_form" class="form-control input-sm" placeholder="废物形态">
                        </td>
                    </tr>
                    <tr>
                        <td><a href="#" onclick="fetch_model_page('rfid_select')"><span class="label label-primary"><span class="glyphicon glyphicon-paperclip"></span> 请选择需要运输的危废 RFID 编号</span><a></td>
                    </tr>
                    <tr>
                        <td>预计危废重量（吨）</td>
                        <td>
                            <input type="text" name="predict_output_weight" class="form-control input-sm" placeholder="预计危废重量（吨）">
                        </td>
                        <td>预计危废数量（桶）</td>
                        <td>
                            <input type="text" name="predict_output_quantity" class="form-control input-sm" placeholder="预计危废数量（桶）">
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-primary">
        <div class="panel-heading">危废仓库贮存情况</div>
        <div class="panel-body">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover table-condensed">
                    <tr>
                        <td>贮存场所</td>
                        <td>
                            <input type="text" name="storage_place" class="form-control input-sm" placeholder="贮存场所">
                        </td>
                        <td>贮存面积（平方米）</td>
                        <td>
                            <input type="text" name="storage_area" class="form-control input-sm" placeholder="贮存面积（平方米）">
                        </td>
                    </tr>
                    <tr>
                        <td>危废容积（立方米）</td>
                        <td>
                            <input type="text" name="waste_volume" class="form-control input-sm" placeholder="危废容积（立方米）">
                        </td>
                        <td>贮存用途</td>
                        <td>
                            <input type="text" name="storage_purpose" class="form-control input-sm" placeholder="贮存用途">
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-primary">
        <div class="panel-heading">运输单位</div>
        <div class="panel-body">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover table-condensed">
                    <tr>
                        <td>运输单位名称</td>
                        <td>
                            <select type="text" id="transport_unit_id" name="transport_unit_id" class="form-control input-sm" onchange="transport_select(this.options[this.options.selectedIndex].value)">
                                <option>请选择运输单位</option>
                            </select>
                        </td>
                        <td>所在区县</td>
                        <td>
                            <select type="text" id="transport_unit_county" name="transport_unit_county" class="form-control input-sm" placeholder="所在区县">
                                    <option>所在区县</option>
                                </select>
                        </td>
                    </tr>
                    <tr>
                        <td>运输单位地址</td>
                        <td>
                            <input type="text" name="transport_unit_address" class="form-control input-sm" placeholder="运输单位地址">
                        </td>
                        <td>运输单位邮编</td>
                        <td>
                            <select type="text" id="transport_unit_county_code" name="transport_unit_postcode" class="form-control input-sm" placeholder="运输单位邮编">
                                <option>运输单位邮编</option>
                            </select>
                        </td>

                    </tr>
                    <tr>
                        <td>运输单位联系人姓名</td>
                        <td>
                            <input type="text" name="transport_unit_contacts_name" class="form-control input-sm" placeholder="运输单位联系人姓名">
                        </td>
                        <td>运输单位联系电话</td>
                        <td>
                            <input type="text" name="transport_unit_contacts_phone" class="form-control input-sm" placeholder="运输单位联系电话">
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-primary">
        <div class="panel-heading">接受单位</div>
        <div class="panel-body">
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover table-condensed">
                      <tr>
                        <td>接受单位名称</td>
                        <td>
                            <select type="text" id="reception_unit_id" name="reception_unit_id" class="form-control input-sm" onchange="reception_select(this.options[this.options.selectedIndex].value)">
                                <option>请选择接受单位</option>
                            </select>
                        </td>
                        <td>所在区县</td>
                        <td>
                            <select type="text" id="reception_unit_county" name="reception_unit_county" class="form-control input-sm" placeholder="所在区县">
                                    <option>所在区县</option>
                                </select>
                        </td>
                    </tr>
                    <tr>
                        <td>接受单位地址</td>
                        <td>
                            <input type="text" name="reception_unit_address" class="form-control input-sm" placeholder="接受单位地址">
                        </td>
                        <td>接受单位邮编</td>
                        <td>
                            <select type="text" id="reception_unit_county_code" name="reception_unit_postcode" class="form-control input-sm" placeholder="接受单位邮编">
                                <option>接受单位邮编</option>
                            </select>
                        </td>

                    </tr>
                    <tr>
                        <td>接受单位联系人姓名</td>
                        <td>
                            <input type="text" name="reception_unit_contacts_name" class="form-control input-sm" placeholder="接受单位联系人姓名">
                        </td>
                        <td>接受单位联系电话</td>
                        <td>
                            <input type="text" name="reception_unit_contacts_phone" class="form-control input-sm" placeholder="接受单位联系电话">
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</form>

<center>
    <button class="btn btn-info btn-lg" id="button_save" data-loading-text="正在保存..." data-complete-text="保存成功！" onclick="ajaxAction(0)">保存</button>
    <button class="btn btn-warning btn-lg" id="button_submit" data-loading-text="正在提交..." data-complete-text="提交成功！" onclick="ajaxAction(1)">提交</button>
</center>

<script type="text/javascript">
$('#transport_unit_id').html('<option>请选择运输单位</option>');
for (var idx in transport_unit) {
$('#transport_unit_id').append('<option value="' + transport_unit[idx].transport_unit_id + '">' + transport_unit[idx].transport_unit_name + '</option>');
    }

$('#reception_unit_id').html('<option>请选择接受单位</option>');
for (var idx in transport_unit) {
$('#reception_unit_id').append('<option value="' + reception_unit[idx].reception_unit_id + '">' + reception_unit[idx].reception_unit_name + '</option>');
    }   

function transport_select(transport_unit_id){
    console.log(transport_unit_id);
    $('#transport_unit_county').html('<option>所在区县</option>');
    $('#transport_unit_county').append('<option value="' + transport_unit[transport_unit_id-1].transport_unit_county + '">' + transport_unit[transport_unit_id-1].transport_unit_county + '</option>');
    $('#transport_unit_county_code').html('<option>运输单位邮编</option>');
    $('#transport_unit_county_code').append('<option value="' + transport_unit[transport_unit_id-1].transport_unit_code + '">' + transport_unit[transport_unit_id-1].transport_unit_code + '</option>');
}

function reception_select(reception_unit_id){
    console.log(reception_unit_id);
    $('#reception_unit_county').html('<option>所在区县</option>');
    $('#reception_unit_county').append('<option value="' + reception_unit[reception_unit_id-1].reception_unit_county + '">' + reception_unit[reception_unit_id-1].reception_unit_county + '</option>');
    $('#reception_unit_county_code').html('<option>接受单位邮编</option>');
    $('#reception_unit_county_code').append('<option value="' + reception_unit[reception_unit_id-1].reception_unit_code + '">' + reception_unit[reception_unit_id-1].reception_unit_code + '</option>');
}

function ajaxAction(actionID) {
    switch (actionID) {
        case 0:
            $('#button_save').button('loading');
            $('#button_submit').addClass('disabled');
            break;
        case 1:
            $('#button_save').addClass('disabled');
            $('#button_submit').button('loading');
            break;
        default:
            break;
    }

    $.ajax({
        type: "post",
        url: "transfer_record_request_form",
        timeout: 2000,
        data: $('#record_request').serialize() + '&record_status=' + actionID,
        /*data: {
            record_status: actionID
        },*/

        success: function(data) {
            switch (actionID) {
                case 0:
                    $('#button_save').button('complete');
                    $('#button_submit').removeClass('disabled');
                    setTimeout("$('#button_save').button('reset')", 3000);
                    break;
                case 1:
                    $('#button_save').removeClass('disabled');
                    $('#button_submit').button('complete');
                    setTimeout("$('#button_submit').button('reset')", 3000);
                    break;
                default:
                    break;
            }
            $('input').val('');
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
            alert('保存失败，请重新保存。');
            console.log("Error: Ajax_Content_Load " + errorThrown);
            console.log("XMLHttpRequest.status: " + XMLHttpRequest.status);
            console.log("XMLHttpRequest.readyState: " + XMLHttpRequest.readyState);
            console.log("textStatus: " + textStatus);
        }
    });

}

function fetch_model_page(ajaxURL) {
    $('#myModal').modal('show');
    $("#model-content").html('<center style="margin-top:20px"><h4>努力地加载中...</h4><div class="progress progress-striped active" style="width: 50%"><div class="progress-bar"  role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div></div></center>');   

    $.ajax({
        type: "get",
        url: ajaxURL,
        dataType: "json",
        success: function(data) {
            $("#model-content").html(data);
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
            console.log("Error:Ajax_Content_Load" + errorThrown);
            console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
            console.log("XMLHttpRequest.readyState:" + XMLHttpRequest.readyState);
            console.log("textStatus:" + textStatus);
        }
    });

}
</script>

<include file="./Public/html/Content/City/city_config.html" />

<script type="text/javascript">
DWMS_page_config.pageid = 1;


function switchControllor() {
    if ($("#map-col").hasClass("col-md-9")) {
        //$("#switch-icon").removeClass("glyphicon-chevron-left").addClass("glyphicon-chevron-right");
        $("#map-controllor").fadeOut("normal", function() {
            $("#map-col").removeClass("col-md-9").addClass("col-md-12");
        });
    } else {
        //$("#switch-icon").removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-left");
        $("#map-col").removeClass("col-md-12").addClass("col-md-9");
        $("#map-controllor").fadeIn("normal");
    }
}
</script>

<div class="row">
    <div class="col-md-3" id="map-controllor">
        <div class="panel panel-primary sidebar_div">
            <div class="panel panel-heading" style="margin-bottom:1px">
                <h3 class="panel-title">数据选项</h3>
            </div>
            <div class="panel panel-body" style="margin-bottom:1px">
                <ul class="nav nav-pills nav-stacked sidebar_list">
                    <li>
                        <a class="dropdown-toggle" data-toggle="dropdown">数据来源<span class="badge pull-right">交通图</span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#">交通图</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a class="dropdown-toggle" data-toggle="dropdown">查看模式<span class="badge pull-right">图标</span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#">交通图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">卫星图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">混合</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a class="dropdown-toggle" data-toggle="dropdown">查看模式<span class="badge pull-right">图标</span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#">交通图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">卫星图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">混合</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <div class="panel panel-primary sidebar_div">
            <div class="panel panel-heading" style="margin-bottom:1px">
                <h3 class="panel-title">地图选项</h3>
            </div>
            <div class="panel panel-body" style="margin-bottom:1px">
                <ul class="nav nav-pills nav-stacked sidebar_list">
                    <li>
                        <a class="dropdown-toggle" data-toggle="dropdown">地图类型<span class="badge pull-right">交通图</span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#">交通图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">卫星图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">混合</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a class="dropdown-toggle" data-toggle="dropdown">查看模式<span class="badge pull-right">图标</span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#">交通图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">卫星图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">混合</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <div class="panel panel-primary sidebar_div">
            <div class="panel panel-heading" style="margin-bottom:1px">
                <h3 class="panel-title">地图选项</h3>
            </div>
            <div class="panel panel-body" style="margin-bottom:1px">
                <ul class="nav nav-pills nav-stacked sidebar_list">
                    <li>
                        <a class="dropdown-toggle" data-toggle="dropdown">地图类型<span class="badge pull-right">交通图</span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#">交通图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">卫星图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">混合</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a class="dropdown-toggle" data-toggle="dropdown">查看模式<span class="badge pull-right">图标</span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="#">交通图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">卫星图</a>
                            </li>
                            <li class="divider"></li>
                            <li><a href="#">混合</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-md-9" id="map-col">

        <div class="panel panel-primary">
            <div class="panel panel-heading" style="margin-bottom:1px" onclick="switchControllor()">
                <h3 class="panel-title">地 图</h3>
            </div>
            <div id="map_container" style="width:auto">Map Loading...</div>
        </div>
    </div>
</div>
<script type="text/javascript">

$('.sidebar_list').children().click(
function() {
        $(this).addClass("active");
    }
  ).hover(
     function() {

    },
    function() {
        $(this).removeClass("active");
    });

function setmap() {
    var windowHeight = $(window).height();
    $("#map_container").css("height", "" + windowHeight - 200 + "px");
    //DWMS_page_config.pageid = 0;
    mapCtr = new BMap.Map("map_container"); // 创建Map实例

    mapCtr.centerAndZoom("上海", 15); // 初始化地图,设置中心o点坐标和地图级别。
    mapCtr.enableScrollWheelZoom();

    mapCtr.addControl(new BMap.NavigationControl());


    /*var myIcon = new BMap.Icon("http://stacky.takau.net/think/DWMS/www/Public/image/header_logo.jpg", new BMap.Size(90, 90), {
        // 指定定位位置。
        // 当标注显示在地图上时，其所指向的地理位置距离图标左上
        // 角各偏移10像素和25像素。您可以看到在本例中该位置即是
        // 图标中央下端的尖角位置。
        offset: new BMap.Size(45, 45),
        // 设置图片偏移。
        // 当您需要从一幅较大的图片中截取某部分作为标注图标时，您
        // 需要指定大图的偏移位置，此做法与css sprites技术类似。
        imageOffset: new BMap.Size(0, 0) // 设置图片偏移
    });
    // 创建标注对象并添加到地图
    var marker = new BMap.Marker(point, {
        icon: myIcon
    });
    map.addOverlay(marker);
    marker.addEventListener("click", function() {
        var opts = {
            width: 250, // 信息窗口宽度
            height: 100, // 信息窗口高度
            title: "药药且可闹" // 信息窗口标题
        }
        var infoWindow = new BMap.InfoWindow("煎饼果子来一套", opts); // 创建信息窗口对象
        map.openInfoWindow(infoWindow, marker.getPosition()); // 打开信息窗口
    });*/


    $.ajax({
        type: "get",
        url: "city?id=bmap_ajax",
        dataType: "json",
        success: function(data) {

            var pointArray = new Array();
            var idx;
            var lat, lng;

            for (idx in data) {
                lng = data[idx].bmap_longitude;
                lat = data[idx].bmap_latitude;

                pointArray.push(new BMap.Point(lng, lat));
                // console.log("lat:"+lat+" lng:"+lng);
            }
            // pointArray.push(new BMap.Point(116.399, 39.910));
            mapCtr.centerAndZoom(pointArray[0], 12);
            var polyline = new BMap.Polyline(pointArray, {
                strokeColor: "blue",
                strokeWeight: 6,
                strokeOpacity: 0.8
            });
            mapCtr.addOverlay(polyline);
            $(".anchorBL").hide()
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
            console.log("Error:Ajax_Content_Load" + errorThrown);
        }
    });


}
setmap();
</script>
